{% extends "base.html" %}

{% block title %}VMware vSphere Reporter - Berichtsoptionen{% endblock %}

{% block extra_head %}
<style>
    .report-section {
        border-left: 3px solid var(--bechtle-dark-blue);
        padding-left: 15px;
        margin-bottom: 20px;
    }
    
    .form-check-input:checked {
        background-color: var(--bechtle-dark-blue);
        border-color: var(--bechtle-dark-blue);
    }
    
    .export-option {
        cursor: pointer;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        transition: all 0.3s;
    }
    
    .export-option:hover {
        border-color: var(--bechtle-dark-blue);
        background-color: rgba(0, 53, 94, 0.05);
    }
    
    .export-option.selected {
        border-color: var(--bechtle-dark-blue);
        background-color: rgba(0, 53, 94, 0.1);
    }
    
    .export-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--bechtle-dark-blue);
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Berichtsoptionen konfigurieren</h4>
                <span class="connection-status connected">
                    <i class="fas fa-check-circle"></i> Verbunden mit {{ session.get('server', '') }}
                </span>
            </div>
            <div class="card-body">
                <form id="reportForm" method="post" action="{{ url_for('options') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="section-title">Berichtsabschnitte</h5>
                            
                            <!-- Pflichtabschnitte -->
                            <div class="report-section">
                                <h6><i class="fas fa-lock-alt me-2"></i>Pflichtabschnitte</h6>
                                <p class="text-muted small">Diese Abschnitte sind immer im Bericht enthalten</p>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_vmware_tools" name="include_vmware_tools" checked disabled>
                                    <input type="hidden" name="include_vmware_tools" value="on">
                                    <label class="form-check-label" for="include_vmware_tools">
                                        VMware Tools Status <span class="badge bg-primary">Wichtig</span>
                                    </label>
                                    <p class="form-text ms-4">Übersicht der VMware Tools Versionen, sortiert nach Alter</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_snapshots" name="include_snapshots" checked disabled>
                                    <input type="hidden" name="include_snapshots" value="on">
                                    <label class="form-check-label" for="include_snapshots">
                                        VM-Snapshots <span class="badge bg-primary">Wichtig</span>
                                    </label>
                                    <p class="form-text ms-4">Liste aller VM-Snapshots, sortiert nach Alter</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_orphaned_vmdks" name="include_orphaned_vmdks" checked disabled>
                                    <input type="hidden" name="include_orphaned_vmdks" value="on">
                                    <label class="form-check-label" for="include_orphaned_vmdks">
                                        Verwaiste VMDKs <span class="badge bg-primary">Wichtig</span>
                                    </label>
                                    <p class="form-text ms-4">Liste potenziell verwaister VMDK-Dateien mit Erklärungen</p>
                                </div>
                            </div>
                            
                            <!-- VM-Informationen -->
                            <div class="report-section">
                                <h6><i class="fas fa-server me-2"></i>VM-Informationen</h6>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_vm_list" name="include_vm_list" checked>
                                    <label class="form-check-label" for="include_vm_list">
                                        VM-Liste
                                    </label>
                                    <p class="form-text ms-4">Vollständige Liste aller virtuellen Maschinen</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_vm_details" name="include_vm_details" checked>
                                    <label class="form-check-label" for="include_vm_details">
                                        VM-Details
                                    </label>
                                    <p class="form-text ms-4">Detaillierte Informationen zu jeder virtuellen Maschine</p>
                                </div>
                            </div>
                            
                            <!-- Infrastruktur-Informationen -->
                            <div class="report-section">
                                <h6><i class="fas fa-network-wired me-2"></i>Infrastruktur</h6>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_esxi_info" name="include_esxi_info" checked>
                                    <label class="form-check-label" for="include_esxi_info">
                                        ESXi-Host Informationen
                                    </label>
                                    <p class="form-text ms-4">Informationen zu allen ESXi-Hosts</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_datastore_info" name="include_datastore_info" checked>
                                    <label class="form-check-label" for="include_datastore_info">
                                        Datastore Informationen
                                    </label>
                                    <p class="form-text ms-4">Details zu allen Datastores inkl. Kapazitäten</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <!-- Netzwerk-Informationen -->
                            <div class="report-section">
                                <h5 class="section-title">Erweiterte Optionen</h5>
                                <h6><i class="fas fa-network-wired me-2"></i>Netzwerk</h6>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_network_info" name="include_network_info" checked>
                                    <label class="form-check-label" for="include_network_info">
                                        Netzwerk Informationen
                                    </label>
                                    <p class="form-text ms-4">Übersicht der Netzwerkkonfiguration</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_distributed_switches" name="include_distributed_switches">
                                    <label class="form-check-label" for="include_distributed_switches">
                                        Distributed Switches
                                    </label>
                                    <p class="form-text ms-4">Details zu verteilten vSwitches und Portgruppen</p>
                                </div>
                            </div>
                            
                            <!-- Cluster-Informationen -->
                            <div class="report-section">
                                <h6><i class="fas fa-cubes me-2"></i>Ressourcen</h6>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_clusters" name="include_clusters" checked>
                                    <label class="form-check-label" for="include_clusters">
                                        Cluster Informationen
                                    </label>
                                    <p class="form-text ms-4">Details zu Clustern und vSphere HA/DRS Konfiguration</p>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_resource_pools" name="include_resource_pools">
                                    <label class="form-check-label" for="include_resource_pools">
                                        Resource Pools
                                    </label>
                                    <p class="form-text ms-4">Ressourcenzuweisung und -begrenzung für VMs</p>
                                </div>
                            </div>
                            
                            <!-- Visualisierung -->
                            <div class="report-section">
                                <h6><i class="fas fa-chart-network me-2"></i>Visualisierung</h6>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="include_topology" name="include_topology" checked>
                                    <label class="form-check-label" for="include_topology">
                                        Infrastruktur-Topologie
                                    </label>
                                    <p class="form-text ms-4">Visuelle Darstellung der vSphere-Infrastruktur</p>
                                </div>
                            </div>
                            
                            <!-- Export-Format -->
                            <div class="mt-4">
                                <h5 class="section-title">Export-Format</h5>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="export-option text-center selected" data-format="html">
                                            <div class="export-icon">
                                                <i class="fas fa-file-code"></i>
                                            </div>
                                            <h6>HTML</h6>
                                            <small class="text-muted">Interaktiv im Browser</small>
                                            <input type="radio" name="export_format" value="html" checked class="d-none">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <div class="export-option text-center" data-format="pdf">
                                            <div class="export-icon">
                                                <i class="fas fa-file-pdf"></i>
                                            </div>
                                            <h6>PDF</h6>
                                            <small class="text-muted">Für Präsentationen</small>
                                            <input type="radio" name="export_format" value="pdf" class="d-none">
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <div class="export-option text-center" data-format="docx">
                                            <div class="export-icon">
                                                <i class="fas fa-file-word"></i>
                                            </div>
                                            <h6>DOCX</h6>
                                            <small class="text-muted">Bearbeitbares Format</small>
                                            <input type="radio" name="export_format" value="docx" class="d-none">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-cogs me-2"></i>Bericht generieren
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-grid gap-2">
                                <a href="{{ url_for('disconnect') }}" class="btn btn-outline-danger">
                                    <i class="fas fa-power-off me-2"></i>Verbindung trennen
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Tipps & Hinweise -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Tipps für optimale Berichte</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <strong>Hinweis:</strong> Je mehr Optionen Sie auswählen, desto länger dauert die Berichtserstellung. Bei großen Umgebungen kann dies mehrere Minuten in Anspruch nehmen.
                </div>
                <ul>
                    <li><strong>VMware Tools Status</strong> identifiziert VMs mit veralteten Tools, die aktualisiert werden sollten.</li>
                    <li><strong>Snapshot-Management</strong> hilft bei der Identifizierung alter Snapshots, die Performance-Probleme verursachen können.</li>
                    <li><strong>VMDK-Analyse</strong> findet potenziell verwaiste Festplatten, die Speicherplatz verschwenden.</li>
                    <li><strong>Topologie-Diagramme</strong> sind im HTML-Format interaktiv und bieten die beste Benutzererfahrung.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Toggle für den "Alle auswählen" Schalter
        $('#selectAll').change(function() {
            $('.optional-section input[type="checkbox"]').prop('checked', $(this).prop('checked'));
        });
        
        // Exportformat-Auswahl
        $('.export-option').click(function() {
            $('.export-option').removeClass('selected');
            $(this).addClass('selected');
            $(this).find('input[type="radio"]').prop('checked', true);
        });
        
        // Formular-Validation
        $('#reportForm').submit(function(event) {
            // Mindestens ein Abschnitt muss ausgewählt sein
            if ($('.form-check-input:checked').length === 0) {
                alert('Bitte wählen Sie mindestens einen Berichtsabschnitt aus.');
                event.preventDefault();
            }
        });
    });
</script>
{% endblock %}