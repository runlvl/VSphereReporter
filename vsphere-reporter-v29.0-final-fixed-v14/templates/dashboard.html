{% extends "base.html" %}

{% block title %}Dashboard - VMware vSphere Reporter{% endblock %}

{% block content %}
<h1 class="my-4">vSphere-Umgebung: Dashboard</h1>

<div class="connect-status mb-4">
    {% if demo_mode %}
    <div class="connect-status-dot connect-status-demo"></div>
    <div>
        <strong>Demo-Modus</strong> - Beispieldaten werden angezeigt
    </div>
    {% else %}
    <div class="connect-status-dot connect-status-online"></div>
    <div>
        <strong>Verbunden mit:</strong> {{ vsphere_host }} als {{ vsphere_user }}
    </div>
    {% endif %}
</div>

<div class="dashboard-cards">
    <div class="card">
        <div class="card-header">Virtuelle Maschinen</div>
        <div class="card-body">
            <div class="card-value">{{ total_vms }}</div>
            <p>Anzahl virtueller Maschinen</p>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-between">
                <span>Eingeschaltet: <strong>{{ vms_by_power_state.poweredOn }}</strong></span>
                <span>Ausgeschaltet: <strong>{{ vms_by_power_state.poweredOff }}</strong></span>
                <span>Angehalten: <strong>{{ vms_by_power_state.suspended }}</strong></span>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Hosts</div>
        <div class="card-body">
            <div class="card-value">{{ total_hosts }}</div>
            <p>Anzahl ESXi-Hosts</p>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Datastores</div>
        <div class="card-body">
            <div class="card-value">{{ total_datastores }}</div>
            <p>Anzahl Datastores</p>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Cluster</div>
        <div class="card-body">
            <div class="card-value">{{ total_clusters }}</div>
            <p>Anzahl Cluster</p>
        </div>
    </div>
</div>

<h2 class="mt-5 mb-4">Status端bersicht</h2>

<div class="row">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">VMware Tools Status</div>
            <div class="card-body">
                {% if outdated_tools > 0 %}
                <div class="card-value text-warning">{{ outdated_tools }}</div>
                <p class="text-warning">VMs mit veralteten oder fehlenden VMware Tools</p>
                {% else %}
                <div class="card-value text-success">0</div>
                <p class="text-success">Alle VMware Tools sind aktuell</p>
                {% endif %}
                <a href="{{ url_for('view_vmware_tools') }}" class="btn btn-outline-primary mt-3">Details anzeigen</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">Snapshots</div>
            <div class="card-body">
                {% if snapshots_count > 0 %}
                <div class="card-value {% if snapshots_count > 10 %}text-warning{% endif %}">{{ snapshots_count }}</div>
                <p>Aktive Snapshots in der Umgebung</p>
                {% else %}
                <div class="card-value text-success">0</div>
                <p class="text-success">Keine aktiven Snapshots</p>
                {% endif %}
                <a href="{{ url_for('view_snapshots') }}" class="btn btn-outline-primary mt-3">Details anzeigen</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">Verwaiste VMDKs</div>
            <div class="card-body">
                {% if orphaned_vmdks_count > 0 %}
                <div class="card-value text-warning">{{ orphaned_vmdks_count }}</div>
                <p class="text-warning">Verwaiste VMDK-Dateien gefunden</p>
                {% else %}
                <div class="card-value text-success">0</div>
                <p class="text-success">Keine verwaisten VMDK-Dateien</p>
                {% endif %}
                <a href="{{ url_for('view_orphaned_vmdks') }}" class="btn btn-outline-primary mt-3">Details anzeigen</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">Schnellaktionen</div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-3">
                    <a href="{{ url_for('report_options') }}" class="btn btn-primary">Neuen Bericht erstellen</a>
                    <a href="{{ url_for('view_vmware_tools') }}" class="btn btn-outline-primary">VMware Tools pr端fen</a>
                    <a href="{{ url_for('view_snapshots') }}" class="btn btn-outline-primary">Snapshots pr端fen</a>
                    <a href="{{ url_for('view_orphaned_vmdks') }}" class="btn btn-outline-primary">Verwaiste VMDKs pr端fen</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}