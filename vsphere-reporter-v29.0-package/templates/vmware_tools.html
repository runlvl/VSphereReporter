{% extends "base.html" %}

{% block title %}VMware Tools | VMware vSphere Reporter v29.0{% endblock %}

{% block extra_head %}
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css">
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h3">VMware Tools Status</h1>
            <button class="btn btn-outline-primary" id="printReport">
                <i class="fas fa-print me-2"></i> Drucken
            </button>
        </div>
        <p class="text-muted mb-4">Dieser Bericht zeigt den Status der VMware Tools in allen virtuellen Maschinen. Die Liste ist nach Status sortiert (nicht installiert oder Update erforderlich zuerst).</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="status-icon-container bg-success-transparent mx-auto mb-3">
                    <i class="fas fa-check-circle fa-2x text-success"></i>
                </div>
                <h5 class="card-title">Aktuell</h5>
                <h2 class="mb-0 tools-current">{{ vms_with_tools|selectattr('tools_status', 'equalto', 'Current')|list|length }}</h2>
                <p class="text-muted small">VMs mit aktuellen Tools</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="status-icon-container bg-warning-transparent mx-auto mb-3">
                    <i class="fas fa-exclamation-circle fa-2x text-warning"></i>
                </div>
                <h5 class="card-title">Update verfügbar</h5>
                <h2 class="mb-0 tools-upgradable">{{ vms_with_tools|selectattr('tools_status', 'equalto', 'UpdateNeeded')|list|length }}</h2>
                <p class="text-muted small">VMs benötigen ein Update</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="status-icon-container bg-danger-transparent mx-auto mb-3">
                    <i class="fas fa-times-circle fa-2x text-danger"></i>
                </div>
                <h5 class="card-title">Nicht installiert</h5>
                <h2 class="mb-0 tools-notinstalled">{{ vms_with_tools|selectattr('tools_status', 'equalto', 'NotInstalled')|list|length }}</h2>
                <p class="text-muted small">VMs ohne Tools</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="status-icon-container bg-secondary-transparent mx-auto mb-3">
                    <i class="fas fa-question-circle fa-2x text-secondary"></i>
                </div>
                <h5 class="card-title">Nicht verwaltet</h5>
                <h2 class="mb-0 tools-unmanaged">{{ vms_with_tools|selectattr('tools_status', 'equalto', 'Unmanaged')|list|length }}</h2>
                <p class="text-muted small">VMs ohne Versionsverwaltung</p>
            </div>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white p-4">
        <h5 class="card-title mb-0">
            <i class="fas fa-tools me-2 text-primary"></i> VMware Tools Übersicht
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="vmwareToolsTable" class="table table-striped table-hover nowrap w-100">
                <thead>
                    <tr>
                        <th>VM-Name</th>
                        <th>Betriebssystem</th>
                        <th>Status</th>
                        <th>Version</th>
                        <th>Laufzeitstatus</th>
                        <th>Letzte Aktualisierung</th>
                        <th>VM-Power</th>
                        <th>ESXi-Host</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vm in vms_with_tools %}
                    <tr>
                        <td>{{ vm.name }}</td>
                        <td>{{ vm.os }}</td>
                        <td>
                            {% if vm.tools_status == 'Current' %}
                            <span class="status-badge status-ok">
                                <i class="fas fa-check-circle"></i> Aktuell
                            </span>
                            {% elif vm.tools_status == 'UpdateNeeded' %}
                            <span class="status-badge status-warning">
                                <i class="fas fa-exclamation-circle"></i> Update verfügbar
                            </span>
                            {% elif vm.tools_status == 'NotInstalled' %}
                            <span class="status-badge status-error">
                                <i class="fas fa-times-circle"></i> Nicht installiert
                            </span>
                            {% else %}
                            <span class="status-badge">
                                <i class="fas fa-question-circle"></i> {{ vm.tools_status }}
                            </span>
                            {% endif %}
                        </td>
                        <td>{{ vm.tools_version }}</td>
                        <td>
                            {% if vm.tools_running_status == 'Running' %}
                            <span class="status-badge status-ok">
                                <i class="fas fa-play"></i> Läuft
                            </span>
                            {% elif vm.tools_running_status == 'Not Running' %}
                            <span class="status-badge status-error">
                                <i class="fas fa-stop"></i> Gestoppt
                            </span>
                            {% else %}
                            <span class="status-badge">
                                <i class="fas fa-question-circle"></i> {{ vm.tools_running_status }}
                            </span>
                            {% endif %}
                        </td>
                        <td>{{ vm.tools_update_time or 'Unbekannt' }}</td>
                        <td>
                            {% if vm.power_state == 'poweredOn' %}
                            <span class="status-badge status-ok">
                                <i class="fas fa-power-off"></i> Eingeschaltet
                            </span>
                            {% elif vm.power_state == 'poweredOff' %}
                            <span class="status-badge">
                                <i class="fas fa-power-off"></i> Ausgeschaltet
                            </span>
                            {% else %}
                            <span class="status-badge status-warning">
                                <i class="fas fa-hourglass-half"></i> {{ vm.power_state }}
                            </span>
                            {% endif %}
                        </td>
                        <td>{{ vm.host }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm mt-4">
    <div class="card-header bg-white p-4">
        <h5 class="card-title mb-0">
            <i class="fas fa-info-circle me-2 text-primary"></i> Über VMware Tools
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6><i class="fas fa-question-circle me-2 text-primary"></i> Was sind VMware Tools?</h6>
                <p class="text-muted">VMware Tools ist ein Satz von Dienstprogrammen und Treibern, die die Leistung und Verwaltung virtueller Maschinen verbessern. Sie umfassen:</p>
                <ul class="mb-4">
                    <li>Optimierte Treiber für Grafik, Netzwerk und Speichergeräte</li>
                    <li>Verbesserte Interaktion zwischen Gast und Host (Kopieren/Einfügen, Drag & Drop)</li>
                    <li>Verbesserte Leistung und Stabilität des Gastbetriebssystems</li>
                    <li>Synchronisierung der Systemzeit zwischen Gast und Host</li>
                </ul>
                
                <h6><i class="fas fa-exclamation-triangle me-2 text-warning"></i> Warum aktualisieren?</h6>
                <ul>
                    <li>Behebung von Sicherheitslücken in älteren Versionen</li>
                    <li>Verbesserte Leistung und Stabilität</li>
                    <li>Unterstützung für neue vSphere-Funktionen</li>
                    <li>Kompatibilität mit neueren Hardware-Versionen</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6><i class="fas fa-lightbulb me-2 text-warning"></i> Best Practices</h6>
                <ul class="mb-4">
                    <li>Halten Sie VMware Tools stets auf dem neuesten Stand</li>
                    <li>Planen Sie Updates während Wartungsfenstern</li>
                    <li>Führen Sie Updates möglichst zeitnah durch</li>
                    <li>Berücksichtigen Sie systemspezifische Anforderungen vor Updates</li>
                </ul>
                
                <h6><i class="fas fa-tags me-2 text-primary"></i> Status-Erklärungen</h6>
                <ul>
                    <li><span class="text-success">Aktuell</span>: VMware Tools sind auf dem neuesten Stand</li>
                    <li><span class="text-warning">Update verfügbar</span>: Eine neuere Version der VMware Tools ist verfügbar</li>
                    <li><span class="text-danger">Nicht installiert</span>: VMware Tools sind nicht installiert</li>
                    <li><span class="text-muted">Nicht verwaltet</span>: VMware Tools werden nicht über die vSphere-Umgebung verwaltet (z.B. Open-VM-Tools)</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="alert alert-info mt-4 mb-4">
    <div class="d-flex">
        <div class="flex-shrink-0">
            <i class="fas fa-lightbulb fa-2x me-3"></i>
        </div>
        <div class="flex-grow-1">
            <h5>Empfehlung</h5>
            <p class="mb-0">Aktualisieren Sie VM-Hardware und VMware Tools gemeinsam und regelmäßig. Die meisten Updates können durchgeführt werden, ohne die VM neu zu starten, erfordern jedoch möglicherweise eine spätere Neustart der VM, um alle Verbesserungen zu aktivieren.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- DataTables JS -->
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>

<script>
    $(document).ready(function() {
        // Initialisiere DataTable
        $('#vmwareToolsTable').DataTable({
            responsive: true,
            language: {
                url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/de-DE.json'
            },
            order: [[2, 'desc']], // Sortiere nach Status (Spalte 2) absteigend
            columnDefs: [
                { responsivePriority: 1, targets: 0 }, // VM-Name immer anzeigen
                { responsivePriority: 2, targets: 2 }, // Status immer anzeigen
                { responsivePriority: 3, targets: 3 }  // Version wichtig
            ]
        });
        
        // Druckfunktion
        $('#printReport').on('click', function() {
            window.print();
        });
    });
</script>
{% endblock %}