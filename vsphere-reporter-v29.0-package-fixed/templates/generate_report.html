{% extends 'base.html' %}

{% block content %}
<h1><i class="fas fa-file-export"></i> Bericht generieren</h1>

<div class="content-section">
    <p class="lead">Erstellen Sie einen umfassenden Bericht in verschiedenen Formaten.</p>
    
    <form method="POST" action="{{ url_for('generate_report') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-cogs"></i> Berichtsoptionen
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Format auswählen:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="formatHtml" value="html" checked>
                                <label class="form-check-label" for="formatHtml">
                                    <i class="fas fa-file-code"></i> HTML
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="formatDocx" value="docx">
                                <label class="form-check-label" for="formatDocx">
                                    <i class="fas fa-file-word"></i> DOCX (Microsoft Word)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="formatPdf" value="pdf">
                                <label class="form-check-label" for="formatPdf">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="formatAll" value="all">
                                <label class="form-check-label" for="formatAll">
                                    <i class="fas fa-file-archive"></i> Alle Formate (ZIP)
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="reportTitle" class="form-label fw-bold">Berichtstitel:</label>
                            <input type="text" class="form-control" id="reportTitle" name="report_title" 
                                   value="VMware vSphere Infrastruktur-Bericht - {{ now.strftime('%d.%m.%Y') }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="companyName" class="form-label fw-bold">Firmenname:</label>
                            <input type="text" class="form-control" id="companyName" name="company_name" value="Bechtle GmbH">
                        </div>
                        
                        <div class="mb-3">
                            <label for="authorName" class="form-label fw-bold">Autor:</label>
                            <input type="text" class="form-control" id="authorName" name="author_name" value="{{ username|default('Administrator') }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-file-alt"></i> Berichtsinhalt
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="includeAll" name="include_all">
                                <label class="form-check-label fw-bold" for="includeAll">Alle Abschnitte einschließen</label>
                            </div>
                            <small class="text-muted">Aktiviert alle unten stehenden Optionen</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Pflichtabschnitte (nicht deaktivierbar):</label>
                            <div class="ps-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="1" checked disabled>
                                    <label class="form-check-label">
                                        <i class="fas fa-tools"></i> VMware Tools Status
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="1" checked disabled>
                                    <label class="form-check-label">
                                        <i class="fas fa-camera"></i> VM-Snapshots
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="1" checked disabled>
                                    <label class="form-check-label">
                                        <i class="fas fa-hdd"></i> Verwaiste VMDKs
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Optionale Abschnitte:</label>
                            <div class="ps-3">
                                <div class="form-check">
                                    <input class="form-check-input optional-section" type="checkbox" id="includeVms" name="include_vms" checked>
                                    <label class="form-check-label" for="includeVms">
                                        <i class="fas fa-laptop"></i> Virtuelle Maschinen
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input optional-section" type="checkbox" id="includeHosts" name="include_hosts" checked>
                                    <label class="form-check-label" for="includeHosts">
                                        <i class="fas fa-server"></i> ESXi Hosts
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input optional-section" type="checkbox" id="includeDatastores" name="include_datastores" checked>
                                    <label class="form-check-label" for="includeDatastores">
                                        <i class="fas fa-database"></i> Datastores
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input optional-section" type="checkbox" id="includeNetworks" name="include_networks" checked>
                                    <label class="form-check-label" for="includeNetworks">
                                        <i class="fas fa-network-wired"></i> Netzwerke
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Design-Optionen:</label>
                            <div class="ps-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeToc" name="include_toc" checked>
                                    <label class="form-check-label" for="includeToc">
                                        <i class="fas fa-list"></i> Inhaltsverzeichnis einschließen
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeCoverPage" name="include_cover_page" checked>
                                    <label class="form-check-label" for="includeCoverPage">
                                        <i class="fas fa-book-open"></i> Deckblatt einschließen
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeLogo" name="include_logo" checked>
                                    <label class="form-check-label" for="includeLogo">
                                        <i class="fas fa-image"></i> Bechtle Logo einschließen
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-file-export"></i> Bericht generieren
            </button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Zurück zum Dashboard
            </a>
        </div>
    </form>
</div>

{% if demo_mode %}
<div class="alert alert-warning mt-4">
    <i class="fas fa-info-circle"></i> <strong>Demo-Modus:</strong> Die generierten Berichte basieren auf Beispieldaten und spiegeln keine echte vSphere-Umgebung wider.
</div>
{% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
    $(document).ready(function() {
        // "Alle Abschnitte einschließen" Checkbox Logik
        $('#includeAll').change(function() {
            $('.optional-section').prop('checked', $(this).is(':checked'));
        });
        
        // Überprüfen, ob alle optionalen Abschnitte ausgewählt sind
        function checkAllSections() {
            const allChecked = $('.optional-section:checked').length === $('.optional-section').length;
            $('#includeAll').prop('checked', allChecked);
        }
        
        // Event-Handler für optionale Abschnitte
        $('.optional-section').change(function() {
            checkAllSections();
        });
    });
</script>
{% endblock %}